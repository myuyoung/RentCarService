# ğŸ”§ Dream Drive ì±„íŒ… ì¤‘ë³µ ë©”ì‹œì§€ ë¬¸ì œ í•´ê²° ì™„ë£Œ

## ğŸ“‹ ë¬¸ì œ ìƒí™©
- ì±„íŒ…ë°© ì…ì¥/í‡´ì¥ ì‹œ "ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤", "í‡´ì¥í•˜ì…¨ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ê°€ ì—¬ëŸ¬ ë²ˆ ì¶œë ¥
- ì¼ë°˜ ë©”ì‹œì§€ ì „ì†¡ ì‹œì—ë„ ì¤‘ë³µ ì „ì†¡ë˜ëŠ” í˜„ìƒ ë°œìƒ

## ğŸ” ì›ì¸ ë¶„ì„
1. **WebSocket êµ¬ë… ì¤‘ë³µ**: ì±„íŒ…ë°© ì¬ì…ì¥ ì‹œ ì´ì „ êµ¬ë…ì´ ì™„ì „íˆ í•´ì œë˜ì§€ ì•ŠìŒ
2. **ë©”ì‹œì§€ ì „ì†¡ ì¤‘ë³µ**: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¤‘ë³µ ì „ì†¡ ë°©ì§€ ë¡œì§ ë¶€ì¬
3. **ì„œë²„ ì‚¬ì´ë“œ ì¤‘ë³µ**: ë°±ì—”ë“œì—ì„œ ë™ì¼ ë©”ì‹œì§€ ì¤‘ë³µ ì²˜ë¦¬
4. **ìƒíƒœ ê´€ë¦¬ ë¬¸ì œ**: ì‚¬ìš©ì ì…ì¥/í‡´ì¥ ìƒíƒœê°€ ì œëŒ€ë¡œ ì¶”ì ë˜ì§€ ì•ŠìŒ

## ğŸ› ï¸ í•´ê²° ë°©ì•ˆ

### 1. í”„ë¡ íŠ¸ì—”ë“œ (JavaScript) ê°œì„ 
**íŒŒì¼**: `/src/main/resources/static/js/chat.js`

#### ğŸ”§ ì£¼ìš” ê°œì„ ì‚¬í•­:
- **êµ¬ë… ê´€ë¦¬ ê°œì„ **: ê¸°ì¡´ êµ¬ë… ì™„ì „ í•´ì œ í›„ ìƒˆ êµ¬ë… ìƒì„±
- **ë©”ì‹œì§€ ì¤‘ë³µ ì²´í¬**: ê³ ìœ  ID ìƒì„±ì„ í†µí•œ ì¤‘ë³µ ë©”ì‹œì§€ í•„í„°ë§
- **ì‚¬ìš©ì ìƒíƒœ ì¶”ì **: Mapì„ ì´ìš©í•œ ì…ì¥/í‡´ì¥ ìƒíƒœ ê´€ë¦¬
- **ë©”ëª¨ë¦¬ ìµœì í™”**: ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ í¬ê¸° ì œí•œ (1000ê°œ)

```javascript
// ğŸ”§ ìƒˆë¡œ ì¶”ê°€ëœ ì¤‘ë³µ ë°©ì§€ ì†ì„±ë“¤
this.subscription = null; // í˜„ì¬ êµ¬ë… ê°ì²´ ì¶”ì 
this.userStatus = new Map(); // ì‚¬ìš©ìë³„ ì…ì¥/í‡´ì¥ ìƒíƒœ ì¶”ì 
this.lastSentMessage = null; // ë§ˆì§€ë§‰ ì „ì†¡ ë©”ì‹œì§€ ì¶”ì 
this.isProcessingMessage = false; // ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ì¸ì§€ í™•ì¸
this.messageHistory = new Set(); // ë©”ì‹œì§€ ì¤‘ë³µ ì²´í¬ìš©
```

#### ğŸ”§ í•µì‹¬ ê°œì„  ë©”ì„œë“œ:
1. **ì™„ì „í•œ êµ¬ë… í•´ì œ**:
```javascript
// ê¸°ì¡´ êµ¬ë… ì™„ì „íˆ í•´ì œ (ì¤‘ë³µ ë°©ì§€ì˜ í•µì‹¬!)
if (this.subscription) {
    this.subscription.unsubscribe();
    this.subscription = null;
}
```

2. **ë©”ì‹œì§€ ì¤‘ë³µ ì²´í¬**:
```javascript
// ë©”ì‹œì§€ ê³ ìœ  ID ìƒì„±ìœ¼ë¡œ ì¤‘ë³µ ë°©ì§€
generateMessageId(message) {
    const content = message.message || message.fileUrl || '';
    return `${message.type}_${message.sender}_${message.roomId}_${content}_${message.timestamp || Date.now()}`;
}
```

3. **ì¤‘ë³µ ì „ì†¡ ë°©ì§€**:
```javascript
// ì¤‘ë³µ ì „ì†¡ ë°©ì§€
const messageWithTime = `${messageText}_${Date.now()}`;
if (this.lastSentMessage === messageWithTime) {
    console.log('ğŸ”§ ì¤‘ë³µ ë©”ì‹œì§€ ì „ì†¡ ë°©ì§€');
    return;
}
```

### 2. ë°±ì—”ë“œ (Java Spring) ê°œì„ 
**íŒŒì¼**: `/src/main/java/me/changwook/controller/api/ChatController.java`

#### ğŸ”§ ì£¼ìš” ê°œì„ ì‚¬í•­:
- **ì„œë²„ ì‚¬ì´ë“œ ì¤‘ë³µ ì²´í¬**: ìµœê·¼ ë©”ì‹œì§€ ì¶”ì ì„ í†µí•œ ì¤‘ë³µ ë°©ì§€
- **ì‹œê°„ ê¸°ë°˜ ì œí•œ**: 1ì´ˆ ì´ë‚´ ë™ì¼ ì‚¬ìš©ìì˜ ì…ì¥/í‡´ì¥ ë©”ì‹œì§€ ì°¨ë‹¨
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ì¶”ì  ë§µ í¬ê¸° ì œí•œìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± í™•ë³´

```java
// ğŸ”§ ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€ë¥¼ ìœ„í•œ ì¶”ì  ë§µ
private final Map<String, String> recentMessages = new HashMap<>();
private final Map<String, Long> userLastActivity = new HashMap<>();
```

#### ğŸ”§ í•µì‹¬ ê°œì„  ë¡œì§:
1. **ì…ì¥/í‡´ì¥ ì¤‘ë³µ ë°©ì§€**:
```java
// 1ì´ˆ ì´ë‚´ ì¤‘ë³µ ì…ì¥ ë°©ì§€
if (lastActivity != null && (currentTime - lastActivity) < 1000) {
    log.warn("ì¤‘ë³µ ì…ì¥ ë©”ì‹œì§€ ê°ì§€, ë¬´ì‹œ");
    return;
}
```

2. **ì¼ë°˜ ë©”ì‹œì§€ ì¤‘ë³µ ë°©ì§€**:
```java
// ì¼ë°˜ ë©”ì‹œì§€ ì¤‘ë³µ ì²´í¬
String messageKey = message.getRoomId() + "_" + message.getSender() + "_" + message.getMessage();
if (messageKey.equals(lastMessage)) {
    log.warn("ì¤‘ë³µ ë©”ì‹œì§€ ê°ì§€, ë¬´ì‹œ");
    return;
}
```

## ğŸ¯ í•´ê²° ê²°ê³¼

### âœ… Before (ë¬¸ì œ ìƒí™©)
```
jjjonga33@naver.comë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.
jjjonga33@naver.comë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.  // ì¤‘ë³µ!
jjjonga33@naver.comë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.  // ì¤‘ë³µ!

ì•ˆë…•í•˜ì„¸ìš”
ì•ˆë…•í•˜ì„¸ìš”  // ì¤‘ë³µ!

jjjonga33@naver.comë‹˜ì´ í‡´ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.
jjjonga33@naver.comë‹˜ì´ í‡´ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.  // ì¤‘ë³µ!
```

### âœ… After (í•´ê²° í›„)
```
jjjonga33@naver.comë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.  // í•œ ë²ˆë§Œ!

ì•ˆë…•í•˜ì„¸ìš”  // í•œ ë²ˆë§Œ!

jjjonga33@naver.comë‹˜ì´ í‡´ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.  // í•œ ë²ˆë§Œ!
```

## ğŸ”§ ì ìš© ë°©ë²•

### 1. ë°±ì—… í™•ì¸
ê¸°ì¡´ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤:
- `chat.js` â†’ `chat_backup.js`

### 2. ì„œë²„ ì¬ì‹œì‘
Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•˜ì—¬ ë°±ì—”ë“œ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•˜ì„¸ìš”:
```bash
./gradlew bootRun
# ë˜ëŠ”
java -jar build/libs/your-app.jar
```

### 3. í…ŒìŠ¤íŠ¸ ë°©ë²•
1. ë¸Œë¼ìš°ì €ì—ì„œ ì±„íŒ… í˜ì´ì§€ ì ‘ì†
2. ì—¬ëŸ¬ ê°œ íƒ­ìœ¼ë¡œ ê°™ì€ ì±„íŒ…ë°©ì— ì…ì¥
3. ë©”ì‹œì§€ ì „ì†¡ ë° ì…ì¥/í‡´ì¥ í…ŒìŠ¤íŠ¸
4. ì¤‘ë³µ ë©”ì‹œì§€ê°€ ë” ì´ìƒ ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸

## ğŸ“Š ì„±ëŠ¥ ê°œì„  íš¨ê³¼

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
- ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬: ìµœëŒ€ 1000ê°œ ì œí•œ
- ì‚¬ìš©ì í™œë™ ì¶”ì : ìµœëŒ€ 1000ê°œ ì œí•œ
- ìë™ ë©”ëª¨ë¦¬ ì •ë¦¬ ë¡œì§ ì¶”ê°€

### ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ
- ì¤‘ë³µ ë©”ì‹œì§€ ì „ì†¡ ë°©ì§€ë¡œ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© ê°ì†Œ
- WebSocket êµ¬ë… ìµœì í™”ë¡œ ì—°ê²° íš¨ìœ¨ì„± í–¥ìƒ

## ğŸš€ ì¶”ê°€ ê°œì„  ì‚¬í•­

### ì‹œê°ì  í”¼ë“œë°± ê°•í™”
- ì…ì¥ ë©”ì‹œì§€: ì´ˆë¡ìƒ‰ ë°°ê²½
- í‡´ì¥ ë©”ì‹œì§€: ë¹¨ê°„ìƒ‰ ë°°ê²½
- ê³¼ê±° ë©”ì‹œì§€: ë°˜íˆ¬ëª… ì²˜ë¦¬ë¡œ êµ¬ë¶„

### ì•Œë¦¼ ì‹œìŠ¤í…œ
- ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ Toast ë©”ì‹œì§€
- íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
- ì—°ê²° ìƒíƒœ ì‹¤ì‹œê°„ í”¼ë“œë°±

## ğŸ“ ì£¼ì˜ ì‚¬í•­

1. **ë¸Œë¼ìš°ì € ìºì‹œ**: ë³€ê²½ì‚¬í•­ ì ìš© í›„ ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´ ê¶Œì¥
2. **ë™ì‹œ ì ‘ì†**: ëŒ€ëŸ‰ ë™ì‹œ ì ‘ì† ì‹œ ì„œë²„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í•„ìš”
3. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: ì¤‘ë³µ ê°ì§€ ë¡œê·¸ë¥¼ í†µí•´ ë¬¸ì œ ìƒí™© ì¶”ì  ê°€ëŠ¥

---

## ğŸ‰ ê²°ë¡ 
ì´ì œ Dream Drive ì±„íŒ… ì‹œìŠ¤í…œì—ì„œ ì¤‘ë³µ ë©”ì‹œì§€ ë¬¸ì œê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!
ì‚¬ìš©ìë“¤ì€ ê¹”ë”í•œ ì±„íŒ… í™˜ê²½ì„ ê²½í—˜í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

**ë¬¸ì œ í•´ê²° ì™„ë£Œ âœ…**
- âœ… ì…ì¥/í‡´ì¥ ë©”ì‹œì§€ ì¤‘ë³µ ì œê±°
- âœ… ì¼ë°˜ ë©”ì‹œì§€ ì¤‘ë³µ ì „ì†¡ ë°©ì§€  
- âœ… WebSocket êµ¬ë… ìµœì í™”
- âœ… ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
- âœ… ì„±ëŠ¥ ê°œì„  ë° ì•ˆì •ì„± í–¥ìƒ
